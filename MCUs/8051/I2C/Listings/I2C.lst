C51 COMPILER V9.60.7.0   I2C                                                               07/05/2023 21:05:16 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN .\Objects\I2C.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Header\I2C.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\I2C.lst) TABS(2) OBJECT(.\Objects\I2C.obj)

line level    source

   1          #include "I2C.h"
   2          
   3          void I2C_Init(void)
   4          {
   5   1        SDA = 1;
   6   1        SCL = 1;
   7   1      }
   8          
   9          void I2C_Start(void)
  10          {
  11   1          SDA = 1;
  12   1          SCL = 1;
  13   1          I2C_Delay(1);
  14   1          SDA = 0;
  15   1      }
  16          
  17          void I2C_Restart(void)
  18          {
  19   1        SCL = 0;
  20   1        SDA = 1;
  21   1        SCL = 1;
  22   1        SDA = 0;
  23   1      }
  24          
  25          void I2C_Stop(void)
  26          {
  27   1          SDA = 0;
  28   1          SCL = 1;
  29   1          I2C_Delay(1);
  30   1          SDA = 1;
  31   1      }
  32          
  33          void I2C_Ack(void)
  34          {
  35   1          while(SDA == 0);                       // wait until slave releases the SDA line
  36   1          SDA = 0;                               // pull down the SDA line low and acknowledge slave
  37   1          I2C_CLK();                             // generate clock signal
  38   1          SDA = 1;                               // release the SDA line
  39   1      }
  40          
  41          void I2C_Nak(void)
  42          {
  43   1        while(SDA == 0);                       // wait until slave releases the SDA line
  44   1        I2C_CLK();                             // generate a clock signal   
  45   1      }
  46          
  47          void I2C_CLK(void)
  48          {
  49   1          SCL = 1;
  50   1          I2C_Delay(3);
  51   1          SCL = 0;
  52   1          I2C_Delay(3);
  53   1      }
  54          
C51 COMPILER V9.60.7.0   I2C                                                               07/05/2023 21:05:16 PAGE 2   

  55          void I2C_Write(unsigned char Data)
  56          {
  57   1          unsigned char i=0;
  58   1          SCL = 0;
  59   1          for(i=0;i<8;i++)
  60   1          {
  61   2            if((Data & 0x80) == 0x80)
  62   2            {
  63   3              SDA = 1;
  64   3            }
  65   2            else
  66   2            {
  67   3              SDA = 0;
  68   3            }
  69   2            Data <<= 1;
  70   2            I2C_CLK();
  71   2          }
  72   1          // acknowledgement while writing to slave
  73   1          SDA = 1;                                // release the SDA line
  74   1          while (SDA == 1);                       // wait until the slave pull down SDA line low
  75   1          I2C_CLK();                        // generate a clock signal
  76   1      }
  77          
  78          
  79          unsigned char I2C_Read(void)
  80          {
  81   1          unsigned char i=0;
  82   1          unsigned char Rd_Val = 0;
  83   1          for(i=0;i<8;i++)
  84   1          {
  85   2            Rd_Val = Rd_Val<<1;
  86   2            if (SDA == 1)
  87   2            {
  88   3              Rd_Val++;
  89   3            }
  90   2            I2C_CLK();
  91   2          }
  92   1          return Rd_Val;
  93   1      }
  94          
  95          void I2C_Delay(unsigned int ms) //delay in milliseconds for 11.0592MHz crystal
  96          {                                            
  97   1      unsigned int i,j;
  98   1      for(i=0;i<ms;i++)
  99   1        {
 100   2        for(j=0;j<110;j++);
 101   2        }
 102   1      }
 103          
 104          //  // Read 1 byte form I2C
 105          //char * I2C_Read_Bytes(unsigned int SlaveID,unsigned char Addr,unsigned int NumBytes)
 106          //{
 107          //    I2C_Start();
 108          //    I2C_Send(SlaveID);
 109          //    I2C_Send(Addr);
 110          //    I2C_Start();
 111          //  
 112          //}
 113          
 114          //// Write multiple byte to I2C
 115          //void I2C_Write_Bytes(unsigned int SlaveID,char *Bytes,unsigned int NumBytes)
 116          //{
C51 COMPILER V9.60.7.0   I2C                                                               07/05/2023 21:05:16 PAGE 3   

 117          //    I2C_Start();
 118          //    I2C_Send(SlaveID);
 119          //    for(unsigned int i=0,i<NumBytes;i++)
 120          //    {
 121          //      I2C_Send(*Bytes);
 122          //      Bytes++;
 123          //    }
 124          //    I2C_Delay(10);
 125          //    I2C_Stop();
 126          //}
 127          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    182    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
